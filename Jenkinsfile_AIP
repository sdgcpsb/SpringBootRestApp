 pipeline {
     
  agent {
    kubernetes {
      label 'SpringBootRestApp'
      defaultContainer 'jnlp'
      yaml """
apiVersion: v1
kind: Pod
metadata:
labels:
  component: ci
spec:
  containers:
  - name: gradle
    image: gradle:3.5-jdk8-alpine
    command:
    - cat
    tty: true
"""
}
	}
  
    stages {
			
			stage('Unit Test') {
				steps {
					container('gradle') {
						
								echo 'I am executing unit test'
								sh '''
								chmod 777 *
								./gradlew clean build
								'''
								
							}
						}
					}
					
					stage('Code Quality') {
		steps {
			container('gradle') {
				
					withSonarQubeEnv(installationName: 'Sonarqube') {
						echo 'I am executing code quality using sonarqube'
						//sh 'mvn -f sample-java-app/pom.xml sonar:sonar'
						sh '''
						
						gradlew Sonarqube -Dsonar.host.url=https://sonarqube.sgn.devops.accentureanalytics.com/projects -Dsonar.verbose=true
						'''
					}
					 /*sleep(60)
					timeout(time: 1, unit: 'MINUTES') {
					waitForQualityGate abortPipeline: true
					} */
				
			}
		}
	}
			
		
		
	
	
	
}
}
